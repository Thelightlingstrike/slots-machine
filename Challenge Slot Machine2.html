<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Challenge Slot Machine</title>
  <style>
    body {
      margin: 0;
      background-color: #000;
      color: #fff;
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      overflow: hidden;
    }
    .slot-container {
      background: #111;
      border: 4px solid #0ff;
      border-radius: 20px;
      padding: 30px;
      width: 90%;
      max-width: 600px;
      text-align: center;
      box-sizing: border-box;
      position: relative;
      z-index: 1;
    }
    .challenge-display {
      font-size: 2rem;
      height: 100px;
      margin-bottom: 20px;
      background: #222;
      border: 2px solid #0ff;
      border-radius: 12px;
      overflow: hidden;
      position: relative;
      z-index: 2;
    }
    .challenge-list-inner {
      position: absolute;
      width: 100%;
      animation-fill-mode: forwards;
    }
    .challenge-item {
      height: 100px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    button {
      background: #0ff;
      color: #000;
      font-size: 1.5rem;
      padding: 10px 30px;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      margin: 10px;
    }
    button:hover {
      background: #0cc;
    }
  </style>
</head>
<body>
  <div class="slot-container">
    <div class="challenge-display" id="challenge-display">
      <div id="reel" class="challenge-list-inner"></div>
    </div>
    <button onclick="spinChallenge()">SPIN ðŸŽ°</button>
  </div>

  <script>
    let challenges = [
      "Only use gray weapons",
      "Wear your mask for one round",
      "Land at edge of map",
      "Play with a blindfold for the drop",
      "Dance every time you get a kill",
      "Use only your pickaxe for the first fight"
    ];

    const reel = document.getElementById('reel');
    const displayHeight = 100;

    // WebSocket setup
    const socket = new WebSocket("ws://localhost:8080");

    socket.addEventListener("message", function(event) {
      const data = JSON.parse(event.data);  // Parse the received JSON

      if (data.event === "slotsStart") {
        spinChallenge();  // Start the game when the server triggers it
      }
    });

    function spinChallenge() {
      if (challenges.length === 0) return;

      reel.innerHTML = '';

      // Generate visible spin list with buffer repeats
      const spinList = [];
      for (let i = 0; i < 20; i++) {
        const randomChallenge = challenges[Math.floor(Math.random() * challenges.length)];
        spinList.push(randomChallenge);
      }

      spinList.forEach((text) => {
        const div = document.createElement('div');
        div.className = 'challenge-item';
        div.textContent = text;
        reel.appendChild(div);
      });

      const finalChallenge = spinList[spinList.length - 1];
      const totalHeight = displayHeight * spinList.length;

      // Reset animation and force a reflow
      reel.style.transition = 'none';
      reel.style.transform = 'translateY(0)';
      void reel.offsetHeight;  // This forces a reflow

      // Wait a tiny bit and then start the animation again
      setTimeout(() => {
        reel.style.transition = 'transform 2s cubic-bezier(0.3, 1, 0.4, 1)';
        reel.style.transform = `translateY(-${totalHeight - displayHeight}px)`;
      }, 50);
    }

    // WebSocket sending JSON data example (when a spin is triggered)
    function startGame() {
      const message = {
        event: "slotsStart",  // Event name
        data: { /* additional data here if needed */ }
      };
      socket.send(JSON.stringify(message));  // Send message to server
    }
  </script>
</body>
</html>
